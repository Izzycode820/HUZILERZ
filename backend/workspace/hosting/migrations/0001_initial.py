# Generated by Django 6.0 on 2025-12-09 09:57

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('subscription', '0001_initial'),
        ('theme', '0001_initial'),
        ('workspace_core', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='DeployedSite',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('site_name', models.CharField(max_length=200)),
                ('slug', models.CharField(max_length=100)),
                ('subdomain', models.CharField(help_text='Auto-generated subdomain (e.g., mikes-store)', max_length=100, unique=True)),
                ('custom_subdomain', models.CharField(blank=True, help_text='User-customized subdomain (optional, takes priority over auto-generated)', max_length=100, null=True, unique=True)),
                ('status', models.CharField(choices=[('active', 'Active'), ('suspended', 'Suspended'), ('maintenance', 'Maintenance'), ('preview', 'Preview Only')], default='preview', max_length=20)),
                ('template_cdn_url', models.URLField(blank=True, help_text='Production CDN URL for Next.js template (e.g., https://cdn.huzilaz.com/templates/store-modern/)')),
                ('template_dev_url', models.URLField(blank=True, default='http://localhost:3001', help_text='Development URL for Next.js template')),
                ('deployment_details', models.JSONField(default=dict, help_text='AWS infrastructure config (CloudFront, Route53, SSL certificates)')),
                ('monthly_bandwidth_gb', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('monthly_requests_count', models.BigIntegerField(default=0)),
                ('last_publish', models.DateTimeField(blank=True, help_text='Last time customization was published (role=active)', null=True)),
                ('uptime_percentage', models.DecimalField(decimal_places=2, default=100.0, max_digits=5)),
                ('avg_load_time_ms', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customization', models.OneToOneField(blank=True, help_text='Active template customization (puck_data) - set when theme is published', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='deployed_site', to='theme.templatecustomization')),
                ('template', models.ForeignKey(blank=True, help_text='Template for this deployment (set when theme is published)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='deployed_instances', to='theme.template')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='deployed_sites', to=settings.AUTH_USER_MODEL)),
                ('workspace', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='deployed_sites', to='workspace_core.workspace')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='CustomDomain',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('domain', models.CharField(help_text='Custom domain (e.g., shoppings.com or www.shoppings.com)', max_length=255, unique=True)),
                ('is_primary', models.BooleanField(default=False, help_text='Primary domain for the deployed site (only one per site)')),
                ('status', models.CharField(choices=[('pending', 'Pending Verification'), ('verified', 'Verified'), ('failed', 'Verification Failed'), ('active', 'Active'), ('suspended', 'Suspended')], default='pending', max_length=20)),
                ('verification_token', models.CharField(help_text='DNS TXT record token for domain ownership verification (_huzilerz-verify)', max_length=64, unique=True)),
                ('verified_at', models.DateTimeField(blank=True, help_text='When domain ownership was verified', null=True)),
                ('verification_method', models.CharField(choices=[('txt', 'DNS TXT Record'), ('cname', 'CNAME Record')], default='txt', max_length=20)),
                ('ssl_enabled', models.BooleanField(default=False, help_text='Whether SSL/TLS is enabled for this domain')),
                ('ssl_certificate_arn', models.CharField(blank=True, help_text='AWS ACM certificate ARN for SSL', max_length=255, null=True)),
                ('ssl_provisioned_at', models.DateTimeField(blank=True, help_text='When SSL certificate was provisioned', null=True)),
                ('dns_records', models.JSONField(default=dict, help_text='Required DNS records for proper configuration')),
                ('purchased_via_platform', models.BooleanField(default=False, help_text='Whether domain was purchased through Huzilerz')),
                ('registrar_domain_id', models.CharField(blank=True, help_text='Domain ID from registrar (Namecheap/GoDaddy)', max_length=255, null=True)),
                ('registrar_name', models.CharField(blank=True, choices=[('namecheap', 'Namecheap'), ('godaddy', 'GoDaddy')], help_text='Domain registrar if purchased via platform', max_length=50, null=True)),
                ('purchase_price_usd', models.DecimalField(blank=True, decimal_places=2, help_text='Domain purchase price in USD (paid to registrar)', max_digits=8, null=True)),
                ('purchase_price_fcfa', models.DecimalField(blank=True, decimal_places=2, help_text='Domain purchase price in FCFA (charged to customer)', max_digits=12, null=True)),
                ('renewal_price_usd', models.DecimalField(blank=True, decimal_places=2, help_text='Annual renewal price in USD (paid to registrar)', max_digits=8, null=True)),
                ('renewal_price_fcfa', models.DecimalField(blank=True, decimal_places=2, help_text='Annual renewal price in FCFA (charged to customer)', max_digits=12, null=True)),
                ('exchange_rate_at_purchase', models.DecimalField(blank=True, decimal_places=2, help_text='USD to FCFA exchange rate at time of purchase (e.g., 600.00)', max_digits=10, null=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Domain expiration date', null=True)),
                ('auto_renew_enabled', models.BooleanField(default=False, help_text='Auto-renewal not supported for mobile money payments (Cameroon market)')),
                ('renewal_reminder_sent', models.BooleanField(default=False, help_text='Whether renewal reminder has been sent for current period')),
                ('last_renewal_warning_sent_at', models.DateTimeField(blank=True, help_text='Last time renewal warning was sent to user', null=True)),
                ('renewal_warning_count', models.IntegerField(default=0, help_text='Number of renewal warnings sent (reset after successful renewal)')),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional domain metadata (SSL info, DNS records, etc.)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_custom_domains', to=settings.AUTH_USER_MODEL)),
                ('workspace', models.ForeignKey(help_text='Workspace that owns this custom domain', on_delete=django.db.models.deletion.CASCADE, related_name='custom_domains', to='workspace_core.workspace')),
                ('deployed_site', models.ForeignKey(blank=True, help_text='Deployed site this domain points to (optional until assigned)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='custom_domains', to='workspace_hosting.deployedsite')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DeploymentAudit',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('initiated', 'Initiated'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('failed', 'Failed'), ('rolled_back', 'Rolled Back')], default='initiated', max_length=20)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('deployment_metadata', models.JSONField(blank=True, default=dict, help_text='CDN invalidation details, health check results, etc.')),
                ('initiated_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('rolled_back_at', models.DateTimeField(blank=True, null=True)),
                ('deployed_site', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='deployment_audits', to='workspace_hosting.deployedsite')),
                ('initiated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='initiated_deployments', to=settings.AUTH_USER_MODEL)),
                ('new_customization', models.ForeignKey(help_text='New theme customization deployed', on_delete=django.db.models.deletion.CASCADE, related_name='new_deployments', to='theme.templatecustomization')),
                ('previous_customization', models.ForeignKey(blank=True, help_text='Previous theme customization before this deployment', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='previous_deployments', to='theme.templatecustomization')),
            ],
            options={
                'db_table': 'deployment_audit',
                'ordering': ['-initiated_at'],
            },
        ),
        migrations.CreateModel(
            name='DeploymentLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('started', 'Started'), ('publishing', 'Publishing'), ('success', 'Success'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='started', max_length=20)),
                ('trigger', models.CharField(help_text="Trigger: 'manual_publish', 'auto_publish', 'rollback', 'dns_update'", max_length=100)),
                ('template_version', models.CharField(blank=True, max_length=50)),
                ('infrastructure_model', models.CharField(max_length=10)),
                ('actions_log', models.JSONField(default=list, help_text="List of actions: ['published_customization', 'updated_dns', 'invalidated_cache']")),
                ('deployment_config', models.JSONField(default=dict)),
                ('error_message', models.TextField(blank=True)),
                ('publish_duration_ms', models.IntegerField(blank=True, help_text='Time to publish customization in milliseconds', null=True)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('customization', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, related_name='deployment_logs', to='theme.templatecustomization')),
                ('site', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='deployment_logs', to='workspace_hosting.deployedsite')),
            ],
            options={
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='DomainPurchase',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('domain_name', models.CharField(help_text='Domain purchased (e.g., mystore.com)', max_length=255)),
                ('registrar', models.CharField(choices=[('namecheap', 'Namecheap'), ('godaddy', 'GoDaddy')], help_text='Registrar used for purchase', max_length=50)),
                ('registrar_order_id', models.CharField(blank=True, help_text='Order ID from registrar API', max_length=255, null=True)),
                ('price_usd', models.DecimalField(decimal_places=2, help_text='Price paid to registrar in USD', max_digits=8)),
                ('price_fcfa', models.DecimalField(decimal_places=2, help_text='Price charged to customer in FCFA', max_digits=12)),
                ('exchange_rate', models.DecimalField(decimal_places=2, help_text='USD to FCFA exchange rate at time of purchase', max_digits=10)),
                ('payment_method', models.CharField(default='mobile_money', help_text='Payment method used (mobile_money, card, etc.)', max_length=50)),
                ('payment_provider', models.CharField(blank=True, help_text='MTN Mobile Money, Orange Money, etc.', max_length=50, null=True)),
                ('payment_reference', models.CharField(blank=True, help_text='Payment reference from mobile money provider', max_length=255, null=True, unique=True)),
                ('payment_status', models.CharField(choices=[('pending', 'Pending Payment'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed'), ('refunded', 'Refunded')], default='pending', max_length=20)),
                ('registration_period_years', models.IntegerField(default=1, help_text='Domain registration period in years')),
                ('registered_at', models.DateTimeField(blank=True, help_text='When domain was successfully registered', null=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Domain expiration date after this purchase', null=True)),
                ('contact_info', models.JSONField(blank=True, default=dict, help_text='Contact information for domain registration (WHOIS)')),
                ('error_message', models.TextField(blank=True, help_text='Error message if purchase failed')),
                ('registrar_response', models.JSONField(blank=True, default=dict, help_text='Full response from registrar API')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('custom_domain', models.ForeignKey(help_text='Domain that was purchased', on_delete=django.db.models.deletion.CASCADE, related_name='purchase_history', to='workspace_hosting.customdomain')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='domain_purchases', to=settings.AUTH_USER_MODEL)),
                ('workspace', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='domain_purchases', to='workspace_core.workspace')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DomainRenewal',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('domain_name', models.CharField(max_length=255)),
                ('registrar', models.CharField(max_length=50)),
                ('registrar_renewal_id', models.CharField(blank=True, help_text='Renewal transaction ID from registrar', max_length=255, null=True)),
                ('renewal_price_usd', models.DecimalField(decimal_places=2, help_text='Renewal price in USD (paid to registrar)', max_digits=8)),
                ('renewal_price_fcfa', models.DecimalField(decimal_places=2, help_text='Renewal price in FCFA (charged to customer)', max_digits=12)),
                ('exchange_rate', models.DecimalField(decimal_places=2, help_text='USD to FCFA exchange rate at time of renewal', max_digits=10)),
                ('payment_method', models.CharField(default='mobile_money', max_length=50)),
                ('payment_provider', models.CharField(blank=True, max_length=50, null=True)),
                ('payment_reference', models.CharField(blank=True, max_length=255, null=True, unique=True)),
                ('renewal_status', models.CharField(choices=[('pending_payment', 'Pending Payment'), ('payment_received', 'Payment Received'), ('processing', 'Processing Renewal'), ('completed', 'Completed'), ('failed', 'Failed'), ('expired', 'Expired - Not Renewed')], default='pending_payment', max_length=20)),
                ('renewal_period_years', models.IntegerField(default=1)),
                ('previous_expiry_date', models.DateTimeField(help_text='Domain expiry date before renewal')),
                ('new_expiry_date', models.DateTimeField(blank=True, help_text='New expiry date after renewal', null=True)),
                ('warning_sent_at', models.DateTimeField(blank=True, help_text='When renewal warning was sent to user', null=True)),
                ('days_before_expiry_warned', models.IntegerField(blank=True, help_text='How many days before expiry the warning was sent (30, 15, 7, 1)', null=True)),
                ('error_message', models.TextField(blank=True)),
                ('registrar_response', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('renewed_at', models.DateTimeField(blank=True, null=True)),
                ('custom_domain', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='renewal_history', to='workspace_hosting.customdomain')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='domain_renewals', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='HostingEnvironment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('initializing', 'Initializing'), ('active', 'Active'), ('suspended', 'Suspended'), ('grace_period', 'Grace Period'), ('error', 'Error')], default='initializing', max_length=20)),
                ('grace_period_end', models.DateTimeField(blank=True, null=True)),
                ('storage_limit_gb', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('bandwidth_limit_gb', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('sites_limit', models.IntegerField(default=0)),
                ('custom_domains_limit', models.IntegerField(default=0)),
                ('storage_used_gb', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('bandwidth_used_gb', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('active_sites_count', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_usage_sync', models.DateTimeField(blank=True, null=True)),
                ('subscription', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='hosting_environment', to='subscription.subscription')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='hosting_environment', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='deployedsite',
            name='hosting_environment',
            field=models.ForeignKey(help_text='Resource quota tracker for this deployment', on_delete=django.db.models.deletion.PROTECT, related_name='deployed_sites', to='workspace_hosting.hostingenvironment'),
        ),
        migrations.CreateModel(
            name='ResourceUsageLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('storage_used_gb', models.DecimalField(decimal_places=4, max_digits=10)),
                ('bandwidth_used_gb', models.DecimalField(decimal_places=4, max_digits=10)),
                ('requests_count', models.BigIntegerField(default=0)),
                ('estimated_cost_usd', models.DecimalField(decimal_places=4, default=0, max_digits=8)),
                ('avg_response_time_ms', models.IntegerField(default=0)),
                ('error_rate_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('recorded_at', models.DateTimeField(auto_now_add=True)),
                ('hosting_environment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='usage_logs', to='workspace_hosting.hostingenvironment')),
                ('site', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='usage_logs', to='workspace_hosting.deployedsite')),
                ('workspace', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='usage_logs', to='workspace_core.workspace')),
            ],
            options={
                'ordering': ['-recorded_at'],
            },
        ),
        migrations.CreateModel(
            name='SitePerformanceMetrics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField()),
                ('uptime_percentage', models.DecimalField(decimal_places=2, default=100.0, max_digits=5)),
                ('avg_load_time_ms', models.IntegerField(default=0)),
                ('avg_response_time_ms', models.IntegerField(default=0)),
                ('largest_contentful_paint', models.IntegerField(default=0)),
                ('first_input_delay', models.IntegerField(default=0)),
                ('cumulative_layout_shift', models.DecimalField(decimal_places=3, default=0, max_digits=4)),
                ('error_rate_4xx', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('error_rate_5xx', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('cache_hit_ratio', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('cdn_response_time_ms', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('site', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='performance_metrics', to='workspace_hosting.deployedsite')),
            ],
            options={
                'ordering': ['-date'],
            },
        ),
        migrations.CreateModel(
            name='SubdomainHistory',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('subdomain', models.CharField(db_index=True, help_text='The subdomain that was used (without .huzilerz.com)', max_length=63)),
                ('used_from', models.DateTimeField(auto_now_add=True, help_text='When this subdomain was assigned to the workspace')),
                ('used_until', models.DateTimeField(blank=True, help_text='When workspace changed from this subdomain (null if still active)', null=True)),
                ('change_reason', models.CharField(blank=True, help_text='Optional reason for subdomain change (e.g., rebranding, typo fix)', max_length=255)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('changed_by', models.ForeignKey(blank=True, help_text='User who initiated the change', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='subdomain_changes', to=settings.AUTH_USER_MODEL)),
                ('workspace', models.ForeignKey(help_text='Workspace that used this subdomain', on_delete=django.db.models.deletion.CASCADE, related_name='subdomain_history', to='workspace_core.workspace')),
            ],
            options={
                'verbose_name': 'Subdomain History',
                'verbose_name_plural': 'Subdomain Histories',
                'db_table': 'subdomain_history',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='WorkspaceInfrastructure',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('subdomain', models.CharField(db_index=True, max_length=255, unique=True)),
                ('preview_url', models.CharField(blank=True, max_length=500)),
                ('status', models.CharField(choices=[('created', 'Created'), ('provisioning_pending', 'Provisioning Pending'), ('provisioning_in_progress', 'Provisioning In Progress'), ('provisioned', 'Provisioned'), ('active', 'Active'), ('failed', 'Failed'), ('degraded', 'Degraded'), ('suspended', 'Suspended')], default='created', max_length=30)),
                ('infra_metadata', models.JSONField(blank=True, default=dict, help_text='CDN URLs, bucket paths, and other infrastructure details')),
                ('assigned_at', models.DateTimeField(auto_now_add=True)),
                ('activated_at', models.DateTimeField(blank=True, null=True)),
                ('subdomain_changes_count', models.IntegerField(default=0, help_text='Number of times subdomain has been changed')),
                ('subdomain_changes_limit', models.IntegerField(default=2, help_text='Maximum number of subdomain changes allowed (aligned with Shopify: 2 changes total)')),
                ('last_subdomain_change_at', models.DateTimeField(blank=True, help_text='Timestamp of last subdomain change', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('pool', models.ForeignKey(blank=True, help_text='Resource quota tracker for workspace owner', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='workspace_infrastructures', to='workspace_hosting.hostingenvironment')),
                ('workspace', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='infrastructure', to='workspace_core.workspace')),
            ],
            options={
                'db_table': 'workspace_infrastructure',
            },
        ),
        migrations.AddIndex(
            model_name='customdomain',
            index=models.Index(fields=['workspace', 'status'], name='workspace_h_workspa_8eea23_idx'),
        ),
        migrations.AddIndex(
            model_name='customdomain',
            index=models.Index(fields=['domain'], name='workspace_h_domain_7ee0fb_idx'),
        ),
        migrations.AddIndex(
            model_name='customdomain',
            index=models.Index(fields=['deployed_site'], name='workspace_h_deploye_f6eafe_idx'),
        ),
        migrations.AddIndex(
            model_name='customdomain',
            index=models.Index(fields=['verification_token'], name='workspace_h_verific_1c204e_idx'),
        ),
        migrations.AddConstraint(
            model_name='customdomain',
            constraint=models.UniqueConstraint(condition=models.Q(('is_primary', True)), fields=('deployed_site', 'is_primary'), name='unique_primary_domain_per_site'),
        ),
        migrations.AddIndex(
            model_name='deploymentaudit',
            index=models.Index(fields=['deployed_site', 'status'], name='deployment__deploye_3723c8_idx'),
        ),
        migrations.AddIndex(
            model_name='deploymentaudit',
            index=models.Index(fields=['initiated_by', 'initiated_at'], name='deployment__initiat_5d2214_idx'),
        ),
        migrations.AddIndex(
            model_name='deploymentaudit',
            index=models.Index(fields=['status', 'initiated_at'], name='deployment__status_425040_idx'),
        ),
        migrations.AddIndex(
            model_name='deploymentlog',
            index=models.Index(fields=['site', '-started_at'], name='workspace_h_site_id_6423b1_idx'),
        ),
        migrations.AddIndex(
            model_name='deploymentlog',
            index=models.Index(fields=['customization', '-started_at'], name='workspace_h_customi_81abbe_idx'),
        ),
        migrations.AddIndex(
            model_name='deploymentlog',
            index=models.Index(fields=['status'], name='workspace_h_status_73a757_idx'),
        ),
        migrations.AddIndex(
            model_name='domainpurchase',
            index=models.Index(fields=['user', '-created_at'], name='workspace_h_user_id_026dae_idx'),
        ),
        migrations.AddIndex(
            model_name='domainpurchase',
            index=models.Index(fields=['custom_domain', '-created_at'], name='workspace_h_custom__2f09c6_idx'),
        ),
        migrations.AddIndex(
            model_name='domainpurchase',
            index=models.Index(fields=['payment_status'], name='workspace_h_payment_4fceae_idx'),
        ),
        migrations.AddIndex(
            model_name='domainpurchase',
            index=models.Index(fields=['payment_reference'], name='workspace_h_payment_fbfdde_idx'),
        ),
        migrations.AddIndex(
            model_name='domainrenewal',
            index=models.Index(fields=['user', '-created_at'], name='workspace_h_user_id_977870_idx'),
        ),
        migrations.AddIndex(
            model_name='domainrenewal',
            index=models.Index(fields=['custom_domain', '-created_at'], name='workspace_h_custom__16e643_idx'),
        ),
        migrations.AddIndex(
            model_name='domainrenewal',
            index=models.Index(fields=['renewal_status'], name='workspace_h_renewal_1e640e_idx'),
        ),
        migrations.AddIndex(
            model_name='domainrenewal',
            index=models.Index(fields=['previous_expiry_date'], name='workspace_h_previou_0593de_idx'),
        ),
        migrations.AddIndex(
            model_name='hostingenvironment',
            index=models.Index(fields=['user', 'status'], name='workspace_h_user_id_25144b_idx'),
        ),
        migrations.AddIndex(
            model_name='hostingenvironment',
            index=models.Index(fields=['subscription'], name='workspace_h_subscri_d4f90c_idx'),
        ),
        migrations.AddIndex(
            model_name='hostingenvironment',
            index=models.Index(fields=['status', 'grace_period_end'], name='workspace_h_status_cb24bb_idx'),
        ),
        migrations.AddIndex(
            model_name='deployedsite',
            index=models.Index(fields=['user', 'status'], name='workspace_h_user_id_e9beef_idx'),
        ),
        migrations.AddIndex(
            model_name='deployedsite',
            index=models.Index(fields=['hosting_environment', 'status'], name='workspace_h_hosting_65f7c0_idx'),
        ),
        migrations.AddIndex(
            model_name='deployedsite',
            index=models.Index(fields=['subdomain'], name='workspace_h_subdoma_288ed3_idx'),
        ),
        migrations.AddIndex(
            model_name='deployedsite',
            index=models.Index(fields=['custom_subdomain'], name='workspace_h_custom__aea3df_idx'),
        ),
        migrations.AddConstraint(
            model_name='deployedsite',
            constraint=models.UniqueConstraint(condition=models.Q(('status', 'active')), fields=('workspace',), name='unique_active_site_per_workspace'),
        ),
        migrations.AlterUniqueTogether(
            name='deployedsite',
            unique_together={('workspace', 'slug')},
        ),
        migrations.AddIndex(
            model_name='resourceusagelog',
            index=models.Index(fields=['hosting_environment', '-recorded_at'], name='workspace_h_hosting_022065_idx'),
        ),
        migrations.AddIndex(
            model_name='resourceusagelog',
            index=models.Index(fields=['workspace', '-recorded_at'], name='workspace_h_workspa_f47b61_idx'),
        ),
        migrations.AddIndex(
            model_name='resourceusagelog',
            index=models.Index(fields=['site', '-recorded_at'], name='workspace_h_site_id_4f3797_idx'),
        ),
        migrations.AddIndex(
            model_name='siteperformancemetrics',
            index=models.Index(fields=['site', '-date'], name='workspace_h_site_id_90c32f_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='siteperformancemetrics',
            unique_together={('site', 'date')},
        ),
        migrations.AddIndex(
            model_name='subdomainhistory',
            index=models.Index(fields=['subdomain'], name='subdomain_h_subdoma_1e0698_idx'),
        ),
        migrations.AddIndex(
            model_name='subdomainhistory',
            index=models.Index(fields=['workspace', '-created_at'], name='subdomain_h_workspa_e66689_idx'),
        ),
        migrations.AddIndex(
            model_name='subdomainhistory',
            index=models.Index(fields=['used_from', 'used_until'], name='subdomain_h_used_fr_d1b95f_idx'),
        ),
        migrations.AddIndex(
            model_name='workspaceinfrastructure',
            index=models.Index(fields=['workspace', 'status'], name='workspace_i_workspa_3338f9_idx'),
        ),
        migrations.AddIndex(
            model_name='workspaceinfrastructure',
            index=models.Index(fields=['subdomain'], name='workspace_i_subdoma_e3c485_idx'),
        ),
        migrations.AddIndex(
            model_name='workspaceinfrastructure',
            index=models.Index(fields=['status'], name='workspace_i_status_36f9f4_idx'),
        ),
    ]

# Generated by Django 6.0 on 2025-12-09 09:57

import datetime
import django.contrib.auth.models
import django.contrib.auth.validators
import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('email', models.EmailField(max_length=254, unique=True)),
                ('phone_number', models.CharField(blank=True, max_length=20, null=True)),
                ('avatar', models.URLField(blank=True, null=True)),
                ('bio', models.TextField(blank=True, max_length=500)),
                ('preferred_auth_method', models.CharField(choices=[('password', 'Password'), ('social', 'Social Login'), ('passwordless', 'Passwordless')], default='password', max_length=50)),
                ('two_factor_enabled', models.BooleanField(default=False)),
                ('security_notifications', models.BooleanField(default=True)),
                ('email_verified', models.BooleanField(default=False)),
                ('phone_verified', models.BooleanField(default=False)),
                ('is_guest_converted', models.BooleanField(default=False)),
                ('guest_actions_count', models.PositiveIntegerField(default=0)),
                ('trial_used_at', models.DateTimeField(blank=True, help_text='When user first used trial (one trial per user ever)', null=True)),
                ('trial_tier_used', models.CharField(blank=True, choices=[('beginning', 'Beginning'), ('pro', 'Pro'), ('enterprise', 'Enterprise')], help_text='Which tier was used for trial', max_length=20, null=True)),
                ('last_login_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('password_changed_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),
            ],
            options={
                'db_table': 'auth_users',
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
        migrations.CreateModel(
            name='SecurityEvent',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('event_type', models.CharField(choices=[('LOGIN_SUCCESS', 'Successful login'), ('LOGIN_FAILED', 'Failed login attempt'), ('LOGIN_SUSPICIOUS', 'Suspicious login detected'), ('LOGOUT', 'User logout'), ('SESSION_EXPIRED', 'Session expired'), ('SESSION_REVOKED', 'Session manually revoked'), ('MFA_SETUP', 'MFA device setup'), ('MFA_SUCCESS', 'MFA verification success'), ('MFA_FAILED', 'MFA verification failed'), ('MFA_LOCKOUT', 'MFA device locked out'), ('MFA_BACKUP_USED', 'Backup code used'), ('MFA_DISABLED', 'MFA disabled'), ('TOKEN_ISSUED', 'JWT token issued'), ('TOKEN_REFRESHED', 'JWT token refreshed'), ('TOKEN_BLACKLISTED', 'Token blacklisted'), ('TOKEN_REUSE_DETECTED', 'Refresh token reuse detected'), ('TOKEN_FAMILY_INVALIDATED', 'Token family invalidated'), ('OAUTH2_SUCCESS', 'OAuth2 authentication success'), ('OAUTH2_FAILED', 'OAuth2 authentication failed'), ('OAUTH2_ACCOUNT_LINKED', 'OAuth2 account linked'), ('EMAIL_VERIFICATION_SENT', 'Email verification code sent'), ('EMAIL_VERIFICATION_SUCCESS', 'Email verification success'), ('EMAIL_VERIFICATION_FAILED', 'Email verification failed'), ('PASSWORD_RESET_REQUESTED', 'Password reset requested'), ('PASSWORD_RESET_SUCCESS', 'Password reset completed'), ('BRUTE_FORCE_DETECTED', 'Brute force attack detected'), ('RATE_LIMIT_EXCEEDED', 'Rate limit exceeded'), ('SUSPICIOUS_LOCATION', 'Login from suspicious location'), ('DEVICE_CHANGE_DETECTED', 'New device detected'), ('CONCURRENT_SESSION_LIMIT', 'Concurrent session limit reached'), ('SECURITY_POLICY_CHANGED', 'Security policy updated'), ('ADMIN_ACTION', 'Administrative security action'), ('SYSTEM_ANOMALY', 'System security anomaly detected')], max_length=50)),
                ('event_description', models.CharField(default='Security event', max_length=255)),
                ('risk_level', models.IntegerField(choices=[(1, 'Low'), (2, 'Medium'), (3, 'High'), (4, 'Critical')], default=1)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, validators=[django.core.validators.validate_ipv46_address])),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('device_fingerprint', models.CharField(blank=True, max_length=64, null=True)),
                ('location_info', models.JSONField(blank=True, null=True)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('timestamp', models.DateTimeField(db_index=True, default=django.utils.timezone.now)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('is_processed', models.BooleanField(default=False)),
                ('processed_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='security_events', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_security_events',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='SecurityAlert',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('alert_type', models.CharField(choices=[('BRUTE_FORCE', 'Brute Force Attack'), ('SUSPICIOUS_LOGIN', 'Suspicious Login'), ('MFA_COMPROMISE', 'MFA Compromise'), ('TOKEN_THEFT', 'Token Theft'), ('ACCOUNT_TAKEOVER', 'Account Takeover'), ('SYSTEM_ANOMALY', 'System Anomaly'), ('POLICY_VIOLATION', 'Policy Violation')], max_length=50)),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField()),
                ('severity', models.CharField(choices=[('LOW', 'Low'), ('MEDIUM', 'Medium'), ('HIGH', 'High'), ('CRITICAL', 'Critical')], max_length=20)),
                ('status', models.CharField(choices=[('OPEN', 'Open'), ('INVESTIGATING', 'Investigating'), ('RESOLVED', 'Resolved'), ('FALSE_POSITIVE', 'False Positive')], default='OPEN', max_length=20)),
                ('alert_data', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_alerts', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='security_alerts', to=settings.AUTH_USER_MODEL)),
                ('related_events', models.ManyToManyField(blank=True, related_name='alerts', to='authentication.securityevent')),
            ],
            options={
                'db_table': 'auth_security_alerts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SecurityMetrics',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('metric_type', models.CharField(choices=[('LOGIN_ATTEMPTS', 'Login Attempts'), ('LOGIN_SUCCESS', 'Successful Logins'), ('LOGIN_FAILED', 'Failed Logins'), ('MFA_USAGE', 'MFA Usage'), ('SUSPICIOUS_ACTIVITIES', 'Suspicious Activities'), ('SECURITY_ALERTS', 'Security Alerts'), ('UNIQUE_USERS', 'Unique Users'), ('UNIQUE_IPS', 'Unique IP Addresses')], max_length=50)),
                ('aggregation_period', models.CharField(choices=[('HOURLY', 'Hourly'), ('DAILY', 'Daily'), ('WEEKLY', 'Weekly'), ('MONTHLY', 'Monthly')], max_length=20)),
                ('period_start', models.DateTimeField(db_index=True)),
                ('period_end', models.DateTimeField()),
                ('count', models.BigIntegerField(default=0)),
                ('breakdown', models.JSONField(blank=True, default=dict)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'db_table': 'auth_security_metrics',
                'ordering': ['-period_start'],
                'indexes': [models.Index(fields=['metric_type', 'period_start'], name='auth_securi_metric__5c388e_idx'), models.Index(fields=['aggregation_period', 'period_start'], name='auth_securi_aggrega_567229_idx')],
                'unique_together': {('metric_type', 'aggregation_period', 'period_start')},
            },
        ),
        migrations.CreateModel(
            name='SessionInfo',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('session_id', models.UUIDField(db_index=True, unique=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('last_activity', models.DateTimeField(default=django.utils.timezone.now)),
                ('expires_at', models.DateTimeField()),
                ('ip_address', models.GenericIPAddressField(validators=[django.core.validators.validate_ipv46_address])),
                ('user_agent', models.TextField()),
                ('device_fingerprint', models.CharField(db_index=True, max_length=64)),
                ('device_info', models.JSONField(blank=True, default=dict)),
                ('location_info', models.JSONField(blank=True, null=True)),
                ('mfa_verified', models.BooleanField(default=False)),
                ('mfa_verified_at', models.DateTimeField(blank=True, null=True)),
                ('is_suspicious', models.BooleanField(default=False)),
                ('security_flags', models.JSONField(blank=True, default=list)),
                ('token_family', models.UUIDField(blank=True, db_index=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='session_info', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_session_info',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SMSDevice',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('phone_number', models.CharField(max_length=20)),
                ('country_code', models.CharField(default='+1', max_length=5)),
                ('is_verified', models.BooleanField(default=False)),
                ('is_active', models.BooleanField(default=False)),
                ('last_sms_sent', models.DateTimeField(blank=True, null=True)),
                ('sms_count_today', models.PositiveIntegerField(default=0)),
                ('max_sms_per_day', models.PositiveSmallIntegerField(default=10)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sms_devices', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_sms_devices',
            },
        ),
        migrations.CreateModel(
            name='ThreatIntelligence',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('ioc_type', models.CharField(choices=[('IP', 'IP Address'), ('DOMAIN', 'Domain'), ('EMAIL', 'Email Address'), ('USER_AGENT', 'User Agent'), ('HASH', 'Hash'), ('URL', 'URL')], max_length=20)),
                ('ioc_value', models.CharField(db_index=True, max_length=255)),
                ('threat_type', models.CharField(choices=[('MALWARE', 'Malware'), ('PHISHING', 'Phishing'), ('BOTNET', 'Botnet'), ('BRUTE_FORCE', 'Brute Force'), ('CREDENTIAL_STUFFING', 'Credential Stuffing'), ('SUSPICIOUS_BEHAVIOR', 'Suspicious Behavior')], max_length=30)),
                ('description', models.TextField()),
                ('severity', models.IntegerField(choices=[(1, 'Low'), (2, 'Medium'), (3, 'High'), (4, 'Critical')])),
                ('confidence', models.IntegerField(default=50)),
                ('source', models.CharField(max_length=100)),
                ('source_url', models.URLField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('first_seen', models.DateTimeField(default=django.utils.timezone.now)),
                ('last_seen', models.DateTimeField(default=django.utils.timezone.now)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('metadata', models.JSONField(blank=True, default=dict)),
            ],
            options={
                'db_table': 'auth_threat_intelligence',
                'ordering': ['-last_seen'],
                'indexes': [models.Index(fields=['ioc_type', 'ioc_value'], name='auth_threat_ioc_typ_03c721_idx'), models.Index(fields=['threat_type', 'is_active'], name='auth_threat_threat__c496ca_idx'), models.Index(fields=['severity', 'is_active'], name='auth_threat_severit_d27a49_idx')],
                'unique_together': {('ioc_type', 'ioc_value')},
            },
        ),
        migrations.CreateModel(
            name='TOTPDevice',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(default='Authenticator App', max_length=100)),
                ('issuer_name', models.CharField(default='HustlerzCamp', max_length=100)),
                ('account_name', models.CharField(blank=True, max_length=255)),
                ('secret_key', models.CharField(max_length=64)),
                ('algorithm', models.CharField(choices=[('SHA1', 'SHA-1'), ('SHA256', 'SHA-256'), ('SHA512', 'SHA-512')], default='SHA1', max_length=10)),
                ('digits', models.PositiveSmallIntegerField(choices=[(6, '6 digits'), (8, '8 digits')], default=6)),
                ('period', models.PositiveSmallIntegerField(default=30)),
                ('is_active', models.BooleanField(default=False)),
                ('is_confirmed', models.BooleanField(default=False)),
                ('is_locked', models.BooleanField(default=False)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('last_used_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('failure_count', models.PositiveIntegerField(default=0)),
                ('consecutive_failures', models.PositiveIntegerField(default=0)),
                ('total_verifications', models.PositiveIntegerField(default=0)),
                ('lockout_until', models.DateTimeField(blank=True, null=True)),
                ('max_failures', models.PositiveSmallIntegerField(default=5)),
                ('lockout_duration_minutes', models.PositiveSmallIntegerField(default=30)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('activated_at', models.DateTimeField(blank=True, null=True)),
                ('last_failure_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='totp_device', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_totp_devices',
            },
        ),
        migrations.CreateModel(
            name='UserSession',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('session_key', models.CharField(db_index=True, max_length=255)),
                ('fingerprint', models.CharField(blank=True, max_length=255)),
                ('device_type', models.CharField(choices=[('desktop', 'Desktop'), ('mobile', 'Mobile'), ('tablet', 'Tablet'), ('unknown', 'Unknown')], default='unknown', max_length=20)),
                ('browser', models.CharField(blank=True, max_length=100)),
                ('os', models.CharField(blank=True, max_length=100)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('location', models.CharField(blank=True, max_length=200)),
                ('is_authenticated', models.BooleanField(default=False)),
                ('authentication_method', models.CharField(choices=[('password', 'Password'), ('social_google', 'Google'), ('social_facebook', 'Facebook'), ('passwordless', 'Passwordless'), ('guest', 'Guest')], default='guest', max_length=50)),
                ('page_views', models.PositiveIntegerField(default=0)),
                ('actions_count', models.PositiveIntegerField(default=0)),
                ('time_spent', models.DurationField(default=datetime.timedelta(0))),
                ('showed_auth_prompt', models.BooleanField(default=False)),
                ('auth_prompt_dismissed_count', models.PositiveSmallIntegerField(default=0)),
                ('converted_to_user', models.BooleanField(default=False)),
                ('conversion_trigger', models.CharField(blank=True, choices=[('wishlist', 'Added to Wishlist'), ('cart', 'Added to Cart'), ('checkout', 'Attempted Checkout'), ('store_visit', 'Store Visit'), ('product_inquiry', 'Product Inquiry'), ('social_prompt', 'Social Prompt'), ('voluntary', 'Voluntary Registration')], max_length=50, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_activity', models.DateTimeField(auto_now=True)),
                ('ended_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_user_sessions',
            },
        ),
        migrations.CreateModel(
            name='WebAuthnDevice',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('credential_id', models.TextField(unique=True)),
                ('public_key', models.TextField()),
                ('sign_count', models.PositiveIntegerField(default=0)),
                ('name', models.CharField(default='Security Key', max_length=100)),
                ('aaguid', models.CharField(blank=True, max_length=100)),
                ('is_active', models.BooleanField(default=True)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='webauthn_devices', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_webauthn_devices',
            },
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('action', models.CharField(choices=[('CREATE', 'Create'), ('READ', 'Read'), ('UPDATE', 'Update'), ('DELETE', 'Delete'), ('LOGIN', 'Login'), ('LOGOUT', 'Logout'), ('PERMISSION_CHANGE', 'Permission Change'), ('CONFIG_CHANGE', 'Configuration Change')], max_length=50)),
                ('resource', models.CharField(max_length=100)),
                ('resource_id', models.CharField(blank=True, max_length=100, null=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, validators=[django.core.validators.validate_ipv46_address])),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('changes', models.JSONField(blank=True, default=dict)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('timestamp', models.DateTimeField(db_index=True, default=django.utils.timezone.now)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='auth_audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_audit_logs',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['action', 'timestamp'], name='auth_audit__action_1fb433_idx'), models.Index(fields=['user', 'timestamp'], name='auth_audit__user_id_581b94_idx'), models.Index(fields=['resource', 'timestamp'], name='auth_audit__resourc_e007ca_idx')],
            },
        ),
        migrations.CreateModel(
            name='BackupCode',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code_hash', models.CharField(max_length=255, unique=True)),
                ('code_partial', models.CharField(max_length=8)),
                ('generation_batch', models.UUIDField(default=uuid.uuid4)),
                ('status', models.CharField(choices=[('unused', 'Unused'), ('used', 'Used'), ('expired', 'Expired'), ('revoked', 'Revoked')], default='unused', max_length=10)),
                ('security_level', models.CharField(choices=[('standard', 'Standard'), ('high', 'High Security')], default='standard', max_length=10)),
                ('used_at', models.DateTimeField(blank=True, null=True)),
                ('used_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('used_user_agent', models.TextField(blank=True)),
                ('verification_attempts', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField()),
                ('revoked_at', models.DateTimeField(blank=True, null=True)),
                ('revoked_reason', models.CharField(blank=True, max_length=100)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='backup_codes', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_backup_codes',
                'indexes': [models.Index(fields=['user', 'status'], name='auth_backup_user_id_5cebbc_idx'), models.Index(fields=['code_hash'], name='auth_backup_code_ha_5b2c68_idx'), models.Index(fields=['generation_batch'], name='auth_backup_generat_e6ddcb_idx'), models.Index(fields=['expires_at'], name='auth_backup_expires_582f60_idx'), models.Index(fields=['created_at'], name='auth_backup_created_64291d_idx')],
                'constraints': [models.CheckConstraint(condition=models.Q(('expires_at__gt', models.F('created_at'))), name='backup_code_valid_expiration')],
            },
        ),
        migrations.CreateModel(
            name='EmailVerificationCode',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('email', models.EmailField(help_text='Email address for verification', max_length=254)),
                ('code_type', models.CharField(choices=[('account_verification', 'Account Verification'), ('password_reset', 'Password Reset'), ('email_change', 'Email Change'), ('login_verification', 'Login Verification')], max_length=20)),
                ('code_hash', models.CharField(help_text='Hashed verification code', max_length=255)),
                ('code_partial', models.CharField(help_text='First 4 digits for reference', max_length=4)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('verified', 'Verified'), ('expired', 'Expired'), ('revoked', 'Revoked')], default='pending', max_length=10)),
                ('attempt_count', models.PositiveIntegerField(default=0)),
                ('max_attempts', models.PositiveIntegerField(default=3)),
                ('requested_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('requested_user_agent', models.TextField(blank=True)),
                ('verified_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('verified_user_agent', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField()),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('last_attempt_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='email_verification_codes', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_email_verification_codes',
                'indexes': [models.Index(fields=['email', 'code_type', 'status'], name='auth_email__email_dc7cdc_idx'), models.Index(fields=['user', 'code_type'], name='auth_email__user_id_688e07_idx'), models.Index(fields=['expires_at'], name='auth_email__expires_3ed1cc_idx'), models.Index(fields=['created_at'], name='auth_email__created_8e6a4c_idx')],
                'constraints': [models.CheckConstraint(condition=models.Q(('expires_at__gt', models.F('created_at'))), name='email_code_valid_expiration')],
            },
        ),
        migrations.CreateModel(
            name='PasswordResetToken',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('token_hash', models.CharField(help_text='Hashed reset token', max_length=255, unique=True)),
                ('token_partial', models.CharField(help_text='Partial token for reference', max_length=8)),
                ('is_used', models.BooleanField(default=False)),
                ('is_expired', models.BooleanField(default=False)),
                ('attempt_count', models.PositiveIntegerField(default=0)),
                ('max_attempts', models.PositiveIntegerField(default=3)),
                ('requested_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('requested_user_agent', models.TextField(blank=True)),
                ('used_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('used_user_agent', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField()),
                ('used_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='password_reset_tokens', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_password_reset_tokens',
                'indexes': [models.Index(fields=['user', 'is_used'], name='auth_passwo_user_id_e53fa6_idx'), models.Index(fields=['expires_at'], name='auth_passwo_expires_ca8703_idx'), models.Index(fields=['created_at'], name='auth_passwo_created_3863d6_idx')],
            },
        ),
        migrations.CreateModel(
            name='RefreshToken',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('token_hash', models.CharField(db_index=True, max_length=255, unique=True)),
                ('jti', models.UUIDField(default=uuid.uuid4, unique=True)),
                ('device_name', models.CharField(blank=True, max_length=100)),
                ('user_agent', models.TextField(blank=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('last_used', models.DateTimeField(auto_now=True)),
                ('expires_at', models.DateTimeField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('revoked_at', models.DateTimeField(blank=True, null=True)),
                ('revoked_by', models.CharField(blank=True, max_length=50, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='refresh_tokens', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'auth_refresh_tokens',
                'indexes': [models.Index(fields=['user', 'is_active'], name='auth_refres_user_id_4ee2e2_idx'), models.Index(fields=['expires_at'], name='auth_refres_expires_4ad26b_idx'), models.Index(fields=['token_hash'], name='auth_refres_token_h_cec3f5_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='securityevent',
            index=models.Index(fields=['event_type', 'timestamp'], name='auth_securi_event_t_8fb98c_idx'),
        ),
        migrations.AddIndex(
            model_name='securityevent',
            index=models.Index(fields=['user', 'timestamp'], name='auth_securi_user_id_9da7ad_idx'),
        ),
        migrations.AddIndex(
            model_name='securityevent',
            index=models.Index(fields=['ip_address', 'timestamp'], name='auth_securi_ip_addr_bc5b90_idx'),
        ),
        migrations.AddIndex(
            model_name='securityevent',
            index=models.Index(fields=['risk_level', 'timestamp'], name='auth_securi_risk_le_bbe691_idx'),
        ),
        migrations.AddIndex(
            model_name='securityevent',
            index=models.Index(fields=['device_fingerprint'], name='auth_securi_device__c48ecc_idx'),
        ),
        migrations.AddIndex(
            model_name='securityalert',
            index=models.Index(fields=['status', 'severity'], name='auth_securi_status_14e89e_idx'),
        ),
        migrations.AddIndex(
            model_name='securityalert',
            index=models.Index(fields=['user', 'created_at'], name='auth_securi_user_id_b16f76_idx'),
        ),
        migrations.AddIndex(
            model_name='securityalert',
            index=models.Index(fields=['alert_type', 'created_at'], name='auth_securi_alert_t_97de3d_idx'),
        ),
        migrations.AddIndex(
            model_name='sessioninfo',
            index=models.Index(fields=['user', 'is_active'], name='auth_sessio_user_id_a0dfb6_idx'),
        ),
        migrations.AddIndex(
            model_name='sessioninfo',
            index=models.Index(fields=['session_id', 'is_active'], name='auth_sessio_session_3b6018_idx'),
        ),
        migrations.AddIndex(
            model_name='sessioninfo',
            index=models.Index(fields=['token_family'], name='auth_sessio_token_f_e1d2fd_idx'),
        ),
        migrations.AddIndex(
            model_name='sessioninfo',
            index=models.Index(fields=['expires_at'], name='auth_sessio_expires_09a678_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='smsdevice',
            unique_together={('user', 'phone_number')},
        ),
        migrations.AddIndex(
            model_name='totpdevice',
            index=models.Index(fields=['user', 'is_active'], name='auth_totp_d_user_id_84ebf6_idx'),
        ),
        migrations.AddIndex(
            model_name='totpdevice',
            index=models.Index(fields=['is_locked', 'lockout_until'], name='auth_totp_d_is_lock_d4caad_idx'),
        ),
        migrations.AddIndex(
            model_name='totpdevice',
            index=models.Index(fields=['last_used'], name='auth_totp_d_last_us_34a1eb_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['user', 'created_at'], name='auth_user_s_user_id_46b246_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['session_key'], name='auth_user_s_session_5780d2_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['ip_address'], name='auth_user_s_ip_addr_ddff1a_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['is_authenticated', 'converted_to_user'], name='auth_user_s_is_auth_0265a9_idx'),
        ),
    ]
